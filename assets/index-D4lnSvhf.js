var k=Object.defineProperty;var q=(e,t,n)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var u=(e,t,n)=>(q(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();class C{constructor(t,n){u(this,"tag");u(this,"className");u(this,"element");this.tag=t,this.className=n,this.element=document.createElement(t),this.element.className=n}addToParent(t){t.appendChild(this.element)}}class x extends C{constructor(n,s,o){super("button",n);u(this,"button");this.button=this.element,this.button.type=s,o&&this.button.addEventListener("click",o)}}class D extends C{constructor(n,s,o){super("input",n);u(this,"value");u(this,"type");u(this,"isValid");const a=this.element;a.placeholder=o,a.type=s,this.type=s,this.value="",this.isValid=!1,this.validateInput()}validateInput(){this.element.addEventListener("input",n=>{const s=n.target;let o=/^[a-zA-Z0-9]*$/;this.type==="password"&&(o=/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])[a-zA-Z0-9-]+$/),this.isValid=o.test(s.value),this.value=s.value;const a=new CustomEvent("inputValidated",{detail:this.isValidInput()});document.dispatchEvent(a)})}isValidInput(){return this.isValid}getInputValue(){return this.value.trim()}}function r(e,t,n){const s=new C(e,t);return n&&s.addToParent(n),s.element}function h(e,t,n,s){const o=s?new x(e,t,s):new x(e,t);return o.element.textContent=n,o.element}function b(e,t,n,s){const o=new D(e,t,n);return s&&o.addToParent(s),o}function F(e,t,n){const s={id:n,login:e,password:t};sessionStorage.setItem("chat-user",JSON.stringify(s))}function _(){const e=sessionStorage.getItem("chat-user");return e?JSON.parse(e):null}function P(){sessionStorage.removeItem("chat-user")}function g(){const e="0123456789",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n="-_",s=e+t+n,o=7;let a="";a+=e.charAt(Math.floor(Math.random()*e.length)),a+=n.charAt(Math.floor(Math.random()*n.length));for(let i=2;i<=o;i+=1)a+=s.charAt(Math.floor(Math.random()*s.length));return a=a.split("").sort(()=>.5-Math.random()).join(""),a}function v(e,t){const n=r("div","title",e);n.textContent=t}function G(){const e=document.createDocumentFragment(),t=r("div","chat__user");r("div","chat__user-info",t);const n=r("div","chat__wrapper",t),s=r("div","chat__user-message",n);v(s,"Pick user and go FUN_CHAT!");const o=r("form","chat__send",t);b("send-input","text","write message",o).element.setAttribute("disabled","true");const i=h("btn send-button","submit","send");return i.setAttribute("disabled","true"),o.appendChild(i),e.append(t),e}function J(e){const t=new Date(e),n=t.toLocaleString("en-GB",{weekday:"short"}),s=t.getDate(),o=t.toLocaleString("en-GB",{month:"short"}),a=t.getFullYear(),i=t.toLocaleTimeString("en-GB",{hourCycle:"h23",hour:"2-digit",minute:"2-digit",second:"2-digit"});return`${n}, ${s} ${o} ${a}, ${i}`}function $(e,t){const{isReaded:n,isDelivered:s}=e;let o;if(t&&typeof e=="boolean")o=t;else switch(!0){case n:o="Read";break;case s:o="Delivered";break;default:o="Sent";break}return o}function y(e,t,n){const s=document.createDocumentFragment(),o=r("div","message",s);n&&o.setAttribute("id",n);const a=r("p","message-status");if(t===e.from){const m=r("p","message-to",o);m.textContent=`To ${e.to}`,o.style.marginLeft="auto",o.style.marginRight="0",a.textContent=$(e.status)}else{const m=r("p","message-from",o);m.textContent=`From ${e.from}`}const i=r("p","message-date",o);i.textContent=J(e.datetime);const c=r("p","message-text",o);return c.textContent=e.text,o.appendChild(a),s}async function B(e,t){const n=document.querySelector(".chat__user-message");e.forEach(s=>{const o=y(s,t);n.appendChild(o)})}function H(e){const t=document.querySelector(".chat__user-message");l(t),t.children.length<1&&(v(t,"write your message"),v(t,`to ${e}`));const n={id:g(),type:"MSG_FROM_USER",payload:{user:{login:e}}},{ws:s}=L;s.send(JSON.stringify(n))}function U(e){const t=document.querySelector(".chat__user-info"),{login:n,isLogined:s}=e;l(t);const o=r("div","user user-login",t);o.textContent=n;const a=r("div","user user-status",t);s?(a.classList.add("user-online"),a.textContent="online"):(a.classList.add("user-offline"),a.textContent="offline")}function W(e){const{id:t,status:n,text:s}=e,o=document.getElementById(t),a=o.querySelector(".message-status"),i=o.querySelector(".message-text");let c;if(a){switch(!0){case n.isReaded:c="Read";break;case n.isEdited:c=`Edited ${o.textContent}`,i.textContent=s;break;default:c="Delivered";break}a.textContent=c}}async function z(e,t,n){const s=document.querySelector(".user-login"),o=document.querySelector(".chat__user-message");if(o.children.length<=2&&l(o),s&&(s.textContent===e.from||s.textContent===e.to)){const i=n?y(e,t,n):y(e,t);document.querySelector(".chat__user-message").appendChild(i)}}function Z(e,t){e.value.length>0?t.removeAttribute("disabled"):t.setAttribute("disabled","true")}function X(e){const t=document.querySelector(".chat__send"),n=t.firstChild,s=t.lastChild;n.removeAttribute("disabled"),n.addEventListener("input",a=>{const i=a.target;i&&Z(i,s)});const{ws:o}=L;t.onsubmit=a=>{a.preventDefault();const i={id:g(),type:"MSG_SEND",payload:{message:{to:e,text:n.value}}};o.send(JSON.stringify(i)),n.value="",s.setAttribute("disabled","true")}}function Y(e){const t=e.target;if(t&&t.classList.contains("user")){const n=t.textContent,s=t.classList.contains("user-online"),o={login:n,isLogined:s};X(n),U(o),H(n)}}function j(e,t){const s=e.target.value.trim().toLowerCase();Array.from(t).forEach(o=>{var i;(i=o.textContent)!=null&&i.toLowerCase().startsWith(s)?o.classList.remove("hide"):o.classList.add("hide")})}function K(){const e=document.createDocumentFragment(),t=r("div","chat__list"),n=b("chat__list-search","search","find user...",t).element,s=r("div","chat__list-wrapper",t),o=r("ul","chat__list-user",s);return n.addEventListener("input",a=>j(a,o.children)),o.addEventListener("click",Y),e.append(t),e}function Q(e){const t=r("div","chat",e),n=K(),s=G();t.append(n,s)}const tt=(e,t,n)=>{e.preventDefault();const s=document.querySelector(".modal");n.classList.remove("blur"),t.removeChild(s)};function et(){const e=document.querySelector(".container");e.classList.add("blur");const t=r("div","modal",document.body),n=r("div","modal__wrapper",t),s=r("div","about",n),o=r("div","about__info",s);o.textContent="This application was developed for the Fun Chat work assignments as part of the RSSchool JS/FE 2023Q4";const a=r("a","about__info",s);a.href="https://github.com/Jezhora",a.textContent="Yauheni Jezhora";const i=h("btn","button","back",c=>tt(c,document.body,e));s.appendChild(i)}const nt=e=>{e.preventDefault(),et()};function st(e){const t=r("h1","title",e);t.textContent="RS FUN-CHAT";const n=h("btn","button","ABOUT",nt);e.append(n)}function N(e){const t=document.querySelector(".logout");e.removeChild(t)}const ot=e=>{e.preventDefault(),P(),ft(),w("/")};function E(e,t){const n=r("div","logout",e),s=r("p","logout__name",n);s.textContent=`${t}`;const o=h("btn","button","LOG OUT",ot);n.appendChild(o)}function at(e){const t=r("header","header",e);return st(t),t}const f=(e,t)=>{Array.from(e.children).forEach(n=>{n.classList.contains(t)&&e.removeChild(n)})},A=(e,t,n)=>{const s=r("div",t);e.appendChild(s),s.textContent=n};function I(e,t,n,s){const o=n.isValidInput(),{length:a}=n.getInputValue();a>=t&&o&&f(e,s),a<t&&(f(e,s),A(e,s,`Must contain at least ${t} symbols`)),a<1&&f(e,s),!o&&a>=t&&(f(e,s),A(e,s,s==="invalid-login"?"English letters, numbers are allowed":"Must contain uppercase and lowercase letters with numbers"))}function it(e,t){const n=e.isValidInput(),s=t.isValidInput(),o=e.getInputValue().length,a=t.getInputValue().length,i=o>2&&a>3;return n&&s&&i}function rt(e,t,n,s){it(e,t)?n.removeAttribute("disabled"):n.setAttribute("disabled","true"),I(s,3,e,"invalid-login"),I(s,4,t,"invalid-password")}async function ct(e,t,n){e.preventDefault();const s=g();T(t.value.trim(),n.value.trim(),s)}const ut=e=>{e.preventDefault(),w("/")};function p(e,t){const n=r("form","login",e),s=b("login__input user-name","text","login",n),o=b("login__input user-password","password","password",n),a=h("btn","submit","go chat");a.setAttribute("disabled","true"),document.addEventListener("inputValidated",()=>rt(s,o,a,n)),n.appendChild(a);const i=s.element,c=o.element;t&&(i.disabled=t,c.disabled=t),n.onsubmit=m=>ct(m,i,c)}function l(e){for(;e.firstChild;)e.removeChild(e.lastChild)}function dt(e,t="404 Page not found"){const n=r("p","title");n.textContent=t,n.style.fontSize="74px";const s=h("btn","button","GO LOGIN PAGE",ut);e.append(n,s)}const M=e=>{e.children.length>2&&N(e)};function S(e){const t=document.querySelector(".main"),n=document.querySelector(".header"),s=_();switch(e){case"/":l(t),s?(p(t,!0),N(n),E(n,s.login)):(p(t),M(n));break;case"/chat":l(t),s?(M(n),E(n,s.login),Q(t)):dt(t,"To access, enter your login and password");break;default:l(t),p(t);break}}function w(e){window.history.pushState({path:e},"",e),S(e)}function lt(){const{ws:e}=L,n={id:g(),type:"USER_ACTIVE",payload:null},o={id:g(),type:"USER_INACTIVE",payload:null};e.send(JSON.stringify(n)),e.send(JSON.stringify(o))}function ht(e,t,n,s){const o={id:s,type:"USER_LOGIN",payload:{user:{login:t,password:n}}};e.send(JSON.stringify(o))}function mt(e,t,n,s,o){const a=JSON.parse(t.data);if(a.type==="USER_LOGIN"&&a.payload.user.isLogined)F(n,s,o),w("/chat");else if(a.type==="ERROR"){const i=document.querySelector(".login"),c=r("p","invalid-password");c.textContent=a.payload.error.toUpperCase(),i.appendChild(c),e.close()}}function V(e,t,n){const o=r("li",t?"user user-online":"user user-offline");o.textContent=e,n.prepend(o)}async function O(e,t){const n=document.querySelector(".chat__list-user"),s=document.createDocumentFragment();e.forEach(o=>{const{login:a,isLogined:i}=o;a!==t&&V(a,i,s)}),n.appendChild(s)}async function R(e){const{login:t,isLogined:n}=e,s=document.querySelector(".chat__list-user"),o=document.querySelectorAll(".user"),a=Array.from(o).filter(i=>i.textContent===t);if(a.length!==0){const i=a[0];s.removeChild(i),n?s.prepend(i):s.appendChild(i),i.classList.toggle("user-offline"),i.classList.toggle("user-online");const c=document.querySelector(".user-login");c&&i.textContent===c.textContent&&U(e)}else V(t,n,s)}let d;const L={get ws(){return d}};async function gt(e,t){const n=JSON.parse(e.data),{type:s,payload:o}=n;switch(s){case"USER_ACTIVE":await O(o.users,t);break;case"USER_INACTIVE":await O(o.users,t);break;case"USER_EXTERNAL_LOGIN":await R(o.user);break;case"USER_EXTERNAL_LOGOUT":await R(o.user);break;case"MSG_FROM_USER":await B(o.messages,t);break;case"MSG_SEND":await z(o.message,t,o.message.id);break;case"MSG_DELIVER":W(o.message);break}}function T(e,t,n=""){d=new WebSocket("ws://localhost:4000"),d.onopen=()=>{ht(d,e,t,n),lt()},d.onmessage=s=>{mt(d,s,e,t,n),gt(s,e)}}function ft(){d&&d.close()}async function pt(){const e=_();if(e){const{login:t,id:n,password:s}=e;T(t,s,n)}}const bt=""+new URL("rs_school-DDD5qqfv.png",import.meta.url).href;function vt(e){const t=r("footer","footer",e),n=r("a","footer__git",t);n.href="https://github.com/Jezhora",n.textContent="Jezhora 2024",n.setAttribute("target","blank");const s=r("a","footer__git",t);s.href="https://rs.school/",s.textContent="The Rolling Scopes",s.setAttribute("target","blank");const o=r("img","footer__logo",t);o.src=`${bt}`,o.alt="RSschool",o.width=150}function yt(){const e=r("div","container",document.body),t=at(e);e.appendChild(t);const n=r("main","main",e);_()?pt():p(n),vt(e)}function St(){const e=document.createElement("meta");e.setAttribute("charset","UTF-8"),document.head.appendChild(e);const t=document.createElement("meta");t.setAttribute("name","viewport"),t.setAttribute("content","width=device-width, initial-scale=1.0"),document.head.appendChild(t);const n=document.createElement("link");n.rel="icon",n.type="image/x-icon",n.href="images/favicon.ico",document.head.appendChild(n);const s=document.createElement("title");s.textContent="RS FunChat",document.head.appendChild(s)}window.addEventListener("DOMContentLoaded",()=>{St(),yt();const e=window.location.pathname;S(e),window.addEventListener("popstate",t=>{const n=t.state?t.state.path:window.location.pathname;S(n)})});
